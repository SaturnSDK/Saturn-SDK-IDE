<toolchain title="MinGW / gcc 3.4" family="C++" id="mingw-gcc34-cpp">
    <!-- $Revision$ -->
    <!-- $Id$ -->
    <!-- $HeadURL$ -->

	<tool id="compiler" executable="mingw32-gcc.exe">
		<search registry="HKEY_CURRENT_USER\Software\Mingw\InstallPath" />
		<search location="C:\MinGW\bin" />
		<search location="$(BIN)" />
		<location>C:\MinGW\include\ctype.h</location>
		<location>C:\mingw\bin</location>
		<challenge>--version</challenge>
		<response>gcc.*(3\.4\.[0-9])</response>
	</tool>

	<tool id="linker" executable="ld.exe">
		<location>[compiler]</location>
		<challenge>--version</challenge>
		<response>ld.*(2\.1[456789]\.[0-9]+)</response>
         ld version 2.15.91
	</tool>

	<tool id="libtool" executable="collect.exe">
		<location>[linker]</location>
	</tool>


    <stage title="precompiling %s" id="precompile">
        <foreach>
            <filetype>h</filetype>
            <filetype>hpp</filetype>
            <filetype>hh</filetype>
            <filetype>hxx</filetype>
            <filetype>h++</filetype>
            <require>compileflag</require>
            <output from="fullname">%s.gch</output>
        </foreach>

        <variant="alongside">
            <exec tool="compiler">$(OPTIONS) $(IN) -o $(OUT)</exec>
        </variant>
        <variant="infolder">
            <exec tool="compiler">$(OPTIONS) $(IN) -o $(OUT)/$(RANDOM_GARBAGE).gch</exec>
        </variant>
    </stage>


	<stage title="compiling %s" id="compile">
        <foreach>
            <filetype>c</filetype>
            <filetype>cpp</filetype>
            <filetype>cxx</filetype>
            <filetype>cc</filetype>
            <filetype>c++</filetype>
            <require>compileflag</require>
            <output from="basename">%s.o</output>
        </foreach>
        <exec tool="compiler">$(OPTIONS) -c $(IN) -o $(OUT)</exec>

		<behaviours>
			<choice id="::optimize">
				<implement value="off">-O0</implement>
				<implement value="size">-Os</implement>
				<implement value="1">-O</implement>
				<implement value="2">-O2</implement>
				<implement value="3">-O3</implement>
				<implement value="4">-O3</implement>
				<implement value="5">-O3 -fexpensive-optimizations -fforce-mem -fforce-addr</implement>
				<implement value="xxx">-O3 -fexpensive-optimizations  -fforce-mem -fforce-addr -ffast-math -frename-registers -mrtd -mregparm=3 </implement>
			</choice>

			<check id="::debug">
				<implement>-g</implement>
				<explicit>-g</>
			</check>
		</behaviours>

		<properties>
			<check title="Strip output executable" id="strip">-s</check>
		</properties>

            <definitions>
                <define>-D$(CONST)</define>
                <define_value>-D$(CONST)=$(VALUE)</define>
                <add_path>-I$(PATH)</add_path>
                <undefine>-U$(CONST)</undefine>
                <path_split>-I-</path_split>
                <no_std_paths>-nostdinc<no_std_paths>
            </definitions>

		<error type="Compiler error" regex="^([a-zA-Z0-9._\-]+:([0-9]+): error: (.*)+$">
			<v id="file" index="1" />
			<v id="line" index="2" />
			<v id="err_level" index="0" />
			<v id="message" index="4" />
		</error>

		<warning type="Compiler warning" regex="^([a-zA-Z0-9._\-]+:([0-9]+): error: (.*)+$">
			<v id="file" index="1" />
			<v id="line" index="2" />
			<v id="err_level" index="0" />
			<v id="message" index="4" />
		</warning>
	</stage>


	<stage title="linking %s" id="link">
            <forall />
    
            <variant="console">
                <exec tool="linker">$(OPTIONS) $(ALL_OBJECT_FILES) $(LIBRARIES) -o $(OUT)</exec>
            </variant>
            <variant="gui">
                <exec tool="linker">$(OPTIONS) -mwindows $(ALL_OBJECT_FILES) $(LIBRARIES) -o $(OUT)</exec>
            </variant>
    
            <properties>
                <filelist id="libs" />
            </properties>
    
            <definitions>
                <add_path>-L$(PATH)</add_path>
            </definitions>
        </stage>

        <definitions>
            <add_path>-L$(PATH)</add_path>
        </definitions>
	</stage>

</toolchain>




